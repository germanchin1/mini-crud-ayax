<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Registro — Mini CRUD</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
<main>
<h1>Registrarse</h1>
<form id="formRegister">
<label for="reg-nombre">Nombre</label>
<input id="reg-nombre" name="nombre" type="text" required>
<label for="reg-email">Email</label>
<input id="reg-email" name="email" type="email" required>
<label for="reg-password">Contraseña</label>
<input id="reg-password" name="password" type="password" required>
<button type="submit">Crear cuenta</button>
</form>
<p>¿Ya tienes cuenta? <a href="/login.html">Entrar</a></p>
<div id="msg" role="status" aria-live="polite"></div>
<script>
const API = '/api.php';
const form = document.getElementById('formRegister');
const msg = document.getElementById('msg');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(form);
  const payload = { nombre: String(fd.get('nombre')||'').trim(), email: String(fd.get('email')||'').trim(), password: String(fd.get('password')||'') };
  try {
    const res = await fetch(`${API}?action=register`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    const j = await res.json();
    if (!j.ok) throw new Error(j.error || 'Error');
    // redirect to protected page
    window.location.href = '/index_ajax.php';
  } catch (err) {
    msg.textContent = err.message;
    msg.className = 'error';
    setTimeout(()=>{ msg.textContent=''; msg.className=''; }, 3000);
  }
});
</script>
</main>
</body>
</html>